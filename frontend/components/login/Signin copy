<template>
  <el-card
    class="grid-content bg-purple-dark"
    shadow="never"
    type="flex"
    justify="center"
  >
    <div slot="header" type="flex" justify="center">
      <h1>Sign In</h1>
      <p>Welcome back!</p>
    </div>
    <UserAuthForm buttonText="Sign in" :submitForm="loginUser" />
  </el-card>
</template>

<script>
import UserAuthForm from "@/components/login/UserAuthForm.vue";

export default {
  name: "Signin",
  components: { UserAuthForm },
  methods: {
    async loginUser(userInfo) {
      // console.log(userInfo);
      try {
        console.log(userInfo.email);
        await this.$axios.post('http://localhost:3000/users/login',
          {
            email: userInfo.email,
            password: userInfo.password
          }
        ).then(
          (response) => {
            console.log(response);
            if (response.status == 200) {
              localStorage.setItem('user',JSON.stringify(response.data));
              localStorage.setItem('jwt',response.data.token);
              console.log('auth value : ' + this.$auth.loggedIn);
              if (localStorage.getItem('jwt') != null){
                this.$emit('loggedIn')
              }
              console.log(this.$auth.isloggedIn);
              console.log(response.data.isadmin);
              if (response.data.isadmin == 1) {
                this.$router.push('/admin');
              } else {
                this.$router.push('/home');
              }
            } else {
              alert(response.data.message);
            }
          }
        );
      } catch(e) {
        console.log(e);
      }
    }
  }
};
</script>
